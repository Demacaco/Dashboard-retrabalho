<!DOCTYPE html>
<html lang="pt-BR">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title>Painel Gestรฃo de Retrabalhos</title>
ย ย <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>๐</text></svg>">
ย ย <script src="https://cdn.tailwindcss.com"></script>
ย ย <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
ย ย <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
ย ย <style>
ย ย ย ย body { font-family: 'Inter', sans-serif; background-color: #0f172a; }
ย ย ย ย .chart-container { position: relative; width: 100%; height: 400px; }
ย ย ย ย .filter-btn.active {ย
ย ย ย ย ย ย background: linear-gradient(135deg, #3b82f6, #1d4ed8);
ย ย ย ย ย ย color: white;
ย ย ย ย ย ย box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
ย ย ย ย }
ย ย ย ยย
ย ย ย ย #loading-overlay {ย
ย ย ย ย ย ย position: fixed; top: 0; left: 0; width: 100%; height: 100%;ย
ย ย ย ย ย ย background: linear-gradient(135deg, #0f172a, #1e293b);
ย ย ย ย ย ย display: flex; justify-content: center; align-items: center;ย
ย ย ย ย ย ย z-index: 9999; color: white; text-align: center; padding: 1rem;ย
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .hidden { display: none !important; }
ย ย ย ยย
ย ย ย ย .spinner {
ย ย ย ย ย ย border: 4px solid rgba(59, 130, 246, 0.3);
ย ย ย ย ย ย border-radius: 50%;
ย ย ย ย ย ย border-top: 4px solid #3b82f6;
ย ย ย ย ย ย width: 50px;
ย ย ย ย ย ย height: 50px;
ย ย ย ย ย ย animation: spin 1s linear infinite;
ย ย ย ย ย ย margin: 0 auto 1rem;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย @keyframes spin {
ย ย ย ย ย ย 0% { transform: rotate(0deg); }
ย ย ย ย ย ย 100% { transform: rotate(360deg); }
ย ย ย ย }

ย ย ย ย .kpi-card {
ย ย ย ย ย ย background: linear-gradient(135deg, #1e293b, #334155);
ย ย ย ย ย ย border-left: 4px solid #3b82f6;
ย ย ย ย ย ย transition: all 0.3s ease;
ย ย ย ย }
        
        /* Classe que estava no seu CSS e eu apaguei sem querer */
        .section-card {
ย ย ย ย ย ย background: linear-gradient(135deg, #1e293b, #334155);
ย ย ย ย }
ย ย </style>
</head>
<body class="text-gray-300">

ย ย <div id="loading-overlay">
ย ย ย ย <div class="flex flex-col items-center">
ย ย ย ย ย ย <div class="spinner"></div>
ย ย ย ย ย ย <p class="text-xl font-semibold">Carregando dados em tempo real...</p>
ย ย ย ย ย ย <p class="text-gray-400 mt-2">Sistema integrado de monitoramento</p>
ย ย ย ย </div>
ย ย </div>

ย ย <div id="dashboard-content" class="container mx-auto p-4 md:p-8 max-w-7xl hidden">
ย ย ย ย ย ย ย ย <header class="text-center mb-8">
ย ย ย ย ย ย <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">
ย ย ย ย ย ย ย ย PAINEL GESTรO DE RETRABALHOS
ย ย ย ย ย ย </h1>
ย ย ย ย ย ย <p class="text-lg text-gray-400">
ย ย ย ย ย ย ย ย Sistema integrado de monitoramento e controle de retrabalhos
ย ย ย ย ย ย </p>
ย ย ย ย </header>

ย ย ย ย ย ย ย ย <section class="mb-8 section-card rounded-xl p-6">
ย ย ย ย ย ย <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
ย ย ย ย ย ย ย ย <h2 class="text-xl font-bold text-white mb-4 md:mb-0">Filtrar por Perรญodo</h2>
ย ย ย ย ย ย ย ย <div class="flex flex-wrap gap-2">
ย ย ย ย ย ย ย ย ย ย <button onclick="filterByPeriod('today')" class="filter-btn bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg text-sm transition duration-300">
ย ย ย ย ย ย ย ย ย ย ย ย ๐ Hoje
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย <button onclick="filterByPeriod('week')" class="filter-btn bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg text-sm transition duration-300">
ย ย ย ย ย ย ย ย ย ย ย ย ๐ รltima Semana
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย <button onclick="filterByPeriod('month')" class="filter-btn bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg text-sm transition duration-300 active">
ย ย ย ย ย ย ย ย ย ย ย ย ๐ รltimo Mรชs
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย <button onclick="filterByPeriod('all')" class="filter-btn bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg text-sm transition duration-300">
ย ย ย ย ย ย ย ย ย ย ย ย ๐๏ธ Perรญodo Completo
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="mt-6">
ย ย ย ย ย ย ย ย <h3 class="text-lg font-semibold text-white mb-3">Filtrar por Marca</h3>
ย ย ย ย ย ย ย ย <div id="brand-filters-container" class="flex flex-wrap gap-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย </section>

ย ย ย ย ย ย ย ย <section id="kpis" class="mb-8 grid grid-cols-1 md:grid-cols-3 gap-6">
ย ย ย ย ย ย <div class="kpi-card rounded-xl p-6 text-center">
ย ย ย ย ย ย ย ย <h3 class="text-lg font-semibold text-gray-400">Total de Itens</h3>
ย ย ย ย ย ย ย ย <p id="total-items" class="text-4xl font-bold text-blue-400 mt-2">0</p>
ย ย ย ย ย ย </div>
ย ย ย ย ย ยย
ย ย ย ย ย ย <div class="kpi-card rounded-xl p-6 text-center">
ย ย ย ย ย ย ย ย <h3 class="text-lg font-semibold text-gray-400">Registros</h3>
ย ย ย ย ย ย ย ย <p id="total-entries" class="text-4xl font-bold text-green-400 mt-2">0</p>
ย ย ย ย ย ย </div>
ย ย ย ย ย ยย
ย ย ย ย ย ย <div class="kpi-card rounded-xl p-6 text-center">
ย ย ย ย ย ย ย ย <h3 class="text-lg font-semibold text-gray-400">Peรงas รnicas</h3>
ย ย ย ย ย ย ย ย <p id="unique-skus" class="text-4xl font-bold text-purple-400 mt-2">0</p>
ย ย ย ย ย ย </div>
ย ย ย ย </section>

ย ย ย ย ย ย ย ย <section class="mb-8 grid grid-cols-1 lg:grid-cols-2 gap-8">
ย ย ย ย ย ย <div class="section-card rounded-xl p-6">
ย ย ย ย ย ย ย ย <h2 class="text-xl font-bold text-white mb-4">Tendรชncia de Retrabalhos</h2>
ย ย ย ย ย ย ย ย <div class="chart-container">
ย ย ย ย ย ย ย ย ย ย <canvas id="trendChart"></canvas>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>

ย ย ย ย ย ย <div class="section-card rounded-xl p-6">
source_timestamp: 1729272948.729
ย ย ย ย ย ย ย ย <h2 class="text-xl font-bold text-white mb-4">Distribuiรงรฃo por Marca</h2>
ย ย ย ย ย ย ย ย <div class="chart-container">
ย ย ย ย ย ย ย ย ย ย <canvas id="brandChart"></canvas>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย </section>

ย ย ย ย ย ย ย ย <section class="mb-8">
ย ย ย ย ย ย <div class="section-card rounded-xl p-6">
ย ย ย ย ย ย ย ย <h2 class="text-xl font-bold text-white mb-4">Atividade por Coletor</h2>
ย ย ย ย ย ย ย ย <div id="collector-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย </section>

ย ย ย ย ย ย ย ย <footer class="text-center mt-12 text-gray-500 text-sm border-t border-gray-800 pt-6">
ย ย ย ย ย ย <p class="font-semibold">ANDRE REZENDE - Sistema de Controle de Retrabalhos ยฉ 2025</p>
ย ย ย ย ย ย <p>รltima atualizaรงรฃo: <span id="update-timestamp" class="text-blue-400"></span></p>
source_timestamp: 1729272948.729
ย ย ย ย </footer>
ย ย </div>

<script>
ย ย // Configuraรงรฃo - USE SUA URL AQUI!
ย ย const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbymVMzJMICCc-iSUjltT1lLm2Rt1auNk5koXImfhHmENhaC6ql8NQfFfTAJHVkt167Q/exec";
ย ยย
ย ย let rawData = [];
ย ย let trendChartInstance = null;
ย ย let brandChartInstance = null;
ย ย let activePeriodFilter = 'month';
ย ย let activeBrandFilter = 'all';

ย ย // ================================================
ย ย // AQUI ESTร A CORREรรO (CรDIGO LIMPO)
ย ย // ================================================
ย ย function fetchDataWithJSONP() {
ย ย ย ย return new Promise((resolve, reject) => {
ย ย ย ย ย ย // 1. CRIE A VARIรVEL 'script' PRIMEIRO
ย ย ย ย ย ย const script = document.createElement('script');
ย ย ย ย ย ย 
ย ย ย ย ย ย // 2. CRIE O NOME DO CALLBACK
ย ย ย ย ย ย const callbackName = 'jsonp_callback_' + Math.round(100000 * Math.random());
ย ย ย ย ย ยย
ย ย ย ย ย ย // 3. AGORA DEFINA A FUNรรO DE CALLBACK (ela pode ver 'script' com seguranรงa)
ย ย ย ย ย ย window[callbackName] = function(data) {
ย ย ย ย ย ย ย ย delete window[callbackName];
ย ย ย ย ย ย ย ย document.body.removeChild(script); // AGORA FUNCIONA
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (data.success) {
ย ย ย ย ย ย ย ย ย ย resolve(data);
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย reject(new Error(data.error));
source_timestamp: 1729272948.729
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย };
ย ย ย ย ย ยย
ย ย ย ย ย ย // 4. CONFIGURE O 'onerror' (tambรฉm pode ver 'script' com seguranรงa)
ย ย ย ย ย ย script.onerror = () => {
ย ย ย ย ย ย ย ย delete window[callbackName];
ย ย ย ย ย ย ย ย // Garante que o script sรณ seja removido se estiver no body
ย ย ย ย ย ย ย ย if (script.parentNode) {
ย ย ย ย ย ย ย ย ย ย script.parentNode.removeChild(script);
A ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย reject(new Error('Falha ao carregar dados'));
ย ย ย ย ย ย };

ย ย ย ย ย ย // 5. CONFIGURE A ORIGEM E ADICIONE AO BODY
ย ย ย ย ย ย script.src = `${SCRIPT_URL}?path=data&callback=${callbackName}&v=${new Date().getTime()}`;
source_timestamp: 1729272948.729
ย ย ย ย ย ย document.body.appendChild(script);
ย ย ย ย });
ย ย }
ย ย // ================================================
ย ย // FIM DA CORREรรO
ย ย // ================================================

ย ย // Funรงรตes de UI
ย ย function showLoading() {ย
ย ย ย ย document.getElementById('loading-overlay').style.display = 'flex';ย
ย ย }
ย ยย
ย ย function hideLoading() {ย
ย ย ย ย document.getElementById('loading-overlay').style.display = 'none';s 
ย ย }
ย ยย
ย ย function showDashboard() {ย
ย ย ย ย document.getElementById('dashboard-content').classList.remove('hidden');ย
ย ย }

ย ย // Funรงรฃo principal para buscar dados
ย ย async function fetchRealData() {
ย ย ย ย try {
ย ย ย ย ย ย showLoading();
ย ย ย ย ย ยย
ย ย ย ย ย ย const result = await fetchDataWithJSONP();
ย ย ย ย ย ย processData(result.data);
source_timestamp: 1729272948.729
ย ย ย ย ย ยย
ย ย ย ย } catch (error) {
ย ย ย ย ย ย console.error('Erro ao carregar dados:', error);
ย ย ย ย ย ย // Mostra dados de exemplo em caso de erro
ย ย ย ย ย ย showError('Usando dados de exemplo devido a problema de conexรฃo');
ย ย ย ย ย ย useSampleData();
ย ย ย ย }
ย ย }

ย ย // Dados de exemplo para fallback
ย ย function useSampleData() {
s ย ย ย const sampleData = [
ย ย ย ย ย ย {
ย ย ย ย ย ย ย ย timestamp: new Date().toISOString(),
ย ย ย ย ย ย ย ย data: new Date().toISOString().split('T')[0],
ย ย ย ย ย ย ย ย coletor: 'COLETOR_001',
ย ย ย ย ย ย ย ย marca: 'Suzuki',
ย ย ย ย ย ย ย ย codigo: 'SKU_001',
ย ย ย ย ย ย ย ย quantidade: '5',
ย ย ย ย ย ย ย ย localizacao: 'SETOR_A'
ย ย ย ย ย ย },
ย ย ย ย ย ย {
ย ย ย ย ย ย ย ย timestamp: new Date(Date.now() - 86400000).toISOString(),
ย ย ย ย ย ย ย ย data: new Date(Date.now() - 86400000).toISOString().split('T')[0],
ย ย ย ย ย ย ย ย coletor: 'COLETOR_002',
ย ย ย ย ย ย ย ย marca: 'Honda',
ย ย ย ย ย ย ย ย codigo: 'SKU_002',
source_timestamp: 1729272948.729
ย ย ย ย ย ย ย ย quantidade: '3',
ย ย ย ย ย ย ย ย localizacao: 'SETOR_B'
ย ย ย ย ย ย }
ย ย ย ย ];
ย ย ย ย processData(sampleData);
s ย }

ย ย function showError(message) {
ย ย ย ย console.warn(message);
ย ย }

ย ย // Processar dados
ย ย function processData(data) {
ย ย ย ย rawData = data.map(item => {
ย ย ย ย ย ย let dateValue = item.data || item.timestamp || item.date;
ย ย ย ย ย ย let dateObj;
ย ย ย ย ย ยย
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย dateObj = new Date(dateValue);
ย ย ย ย ย ย ย ย if (isNaN(dateObj.getTime())) {
ย ย ย ย ย ย ย ย ย ย dateObj = new Date();
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย } catch (e) {
source_timestamp: 1729272948.729
ย ย ย ย ย ย ย ย dateObj = new Date();
ย ย ย ย ย ย }

ย ย ย ย ย ย return {
ย ย ย ย ย ย ย ย timestamp: dateObj,
s ย ย ย ย ย ย ย date: dateObj.toISOString().split('T')[0],
ย ย ย ย ย ย ย ย collector: item.coletor || item.collector || 'Desconhecido',
ย ย ย ย ย ย ย ย brand: item.marca || item.brand || 'Sem Marca',
ย ย ย ย ย ย ย ย sku: item.codigo || item.sku || 'N/A',
ย ย ย ย ย ย ย ย quantity: parseInt(item.quantidade || item.quantity) || 0,
ย ย ย ย ย ย ย ย location: item.localizacao || item.location || 'N/A'
s ย ย ย ย ย };
ย ย ย _ });

ย ย ย ย initializeApp();
ย ย }

ย ย function filterByPeriod(period) {
ย ย ย ย activePeriodFilter = period;
ย ย ย ย document.querySelectorAll('.filter-btn').forEach(btn => {
ย ย ย ย ย ย btn.classList.remove('active');
ย ย ย ย });
ย ย ย ย event.target.classList.add('active');
ย ย ย ย updateDashboard();
ย ย }

ย ย function applyPeriodFilter(data) {
ย ย ย ย const today = new Date();
ย ย ย ย let startDate;

ย ย ย ย switch(activePeriodFilter) {
A ย ย ย ย ย case 'today':
ย ย ย ย ย ย ย ย startDate = new Date(today);
ย ย ย ย ย ย ย ย startDate.setHours(0, 0, 0, 0);
ย ย ย ย ย ย ย ย return data.filter(item => item.timestamp >= startDate);
ย ย ย ย ย ย case 'week':
ย ย ย ย ย ย ย ย startDate = new Date(today);
ย ย ย ย ย ย ย ย startDate.setDate(today.getDate() - 7);
ย ย ย ย ย ย ย ย return data.filter(item => item.timestamp >= startDate);
ย ย ย ย ย ย case 'month':
source_timestamp: 1729272948.729
ย ย ย ย ย ย ย ย startDate = new Date(today);
ย ย ย ย ย ย ย ย startDate.setMonth(today.getMonth() - 1);
ย ย ย ย ย ย ย ย return data.filter(item => item.timestamp >= startDate);
ย ย ย ย ย ย case 'all':
ย ย ย ย ย ย default:
ย ย ย ย ย ย ย ย return data;
ย ย ย ย }
ย ย }

ย ย function initializeApp() {
ย ย ย ย showDashboard();
ย ย ย ย setupBrandFilters();
ย ย ย ย updateDashboard();
ย ย ย ย document.getElementById('update-timestamp').textContent = new Date().toLocaleString('pt-BR');
ย ย ย ยย
ย s ย ย document.getElementById('brand-filters-container').addEventListener('click', (e) => {
ย ย ย ย ย ย if (e.target.classList.contains('brand-btn')) {
ย ย ย ย ย ย ย ย activeBrandFilter = e.target.dataset.brand;
s ย ย ย ย ย ย ย updateDashboard();
ย ย ย ย ย ย }
ย ย ย ย });
ย ย }

ย ย function setupBrandFilters() {
ย ย ย ย const brands = [...new Set(rawData.map(item => item.brand))].filter(Boolean).sort();
ย ย ย ย const brandContainer = document.getElementById('brand-filters-container');
ย ย ย ยย
ย ย ย ย brandContainer.innerHTML = '<button class="brand-btn bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg text-sm transition duration-300 active" data-brand="all">Todas as Marcas</button>';
ย ย ย ยย
ย ย ย ย brands.forEach(brand => {
ย ย ย ย ย ย const btn = document.createElement('button');
ย S ย ย ย ย btn.textContent = brand;
ย ย ย ย ย ย btn.dataset.brand = brand;
ย ย ย ย ย ย btn.className = 'brand-btn bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg text-sm transition duration-300';
ย ย ย ย ย ย brandContainer.appendChild(btn);
ย ย ย ย });
ย ย }

ย ย function updateDashboard() {
ย ย ย ย let filteredData = applyPeriodFilter(rawData);
ย ย ย ยย
ย ย ย ย if (activeBrandFilter !== 'all') {
ย ย ย ย ย ย filteredData = filteredData.filter(item => item.brand === activeBrandFilter);
ย ย ย ย }

ย ย ย ย document.getElementById('total-items').textContent = filteredData
ย ย ย ย ย ย .reduce((sum, item) => sum + (item.quantity || 0), 0)
s ย ย ย ย ย .toLocaleString('pt-BR');
ย ย ย ย ย ยย
ย ย ย ย document.getElementById('total-entries').textContent = filteredData.length.toLocaleString('pt-BR');
ย ย ย ยย
ย ย ย ย document.getElementById('unique-skus').textContent = new Set(
ย ย ย ย ย ย filteredData.map(item => item.sku).filter(sku => sku)
ย ย ย ย ).size.toLocaleString('pt-BR');
ย ย ย ยย
ย ย ย ย renderTrendChart(filteredData);
ย ย ย ย renderBrandChart(filteredData);
ย ย ย ย renderCollectorCards(filteredData);
ย ย }

ย ย function renderTrendChart(data) {
ย ย ย ย const trendData = data.reduce((acc, item) => {
ย ย ย ย ย ย acc[item.date] = (acc[item.date] || 0) + (item.quantity || 0);
source_timestamp: 1729272948.729
ย ย ย ย ย ย return acc;
ย ย ย ย }, {});
ย ย ย ยย
ย ย ย ย const sortedDates = Object.keys(trendData).sort((a, b) => new Date(a) - new Date(b));
ย ย ย ย const labels = sortedDates.map(date =>ย
ย ย ย ย ย ย new Date(date + 'T00:00:00').toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' })
ย ย ย ย );
ย ย ย ย const chartData = sortedDates.map(date => trendData[date]);
ย ย ย ยย
ย ย ย ย const ctx = document.getElementById('trendChart').getContext('2d');
ย ย ย ยย
ย ย ย ย if (trendChartInstance) {
ย ย ย ย ย ย trendChartInstance.destroy();
ย ย ย ย }
ย ย ย ยย
ย ย ย ย trendChartInstance = new Chart(ctx, {
ย ย ย ย ย ย type: 'line',
ย ย ย ย ย ย data: {
ย ย ย ย ย ย ย ย labels: labels,
ย ย ย ย ย ย ย ย datasets: [{
ย ย ย ย ย ย ย ย ย ย label: 'Quantidade de Retrabalhos',
ย ย ย ย ย ย ย ย ย ย data: chartData,
ย ย ย ย ย ย ย ย ย ย fill: true,
source_timestamp: 1729272948.729
ย ย ย ย ย ย ย ย ย ย backgroundColor: 'rgba(59, 130, 246, 0.1)',
ย ย ย ย ย ย ย ย ย ย borderColor: 'rgba(59, 130, 246, 1)',
ย ย ย ย ย ย ย ย ย ย borderWidth: 3,
ย ย ย ย ย ย ย ย ย ย tension: 0.4
ย s ย ย ย ย ย ย }]
ย ย ย ย ย ย },
ย ย ย ย ย ย options: {
ย ย ย ย ย ย ย ย maintainAspectRatio: false,
s ย ย ย ย ย ย ย responsive: true,
ย ย ย ย ย ย ย ย scales: {
ย ย ย ย ย ย ย ย ย ย y: { beginAtZero: true, ticks: { color: '#d1d5db' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } },
ย ย ย ย ย ย ย ย ย ย x: { ticks: { color: '#d1d5db' }, grid: { display: false } }
ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย plugins: { legend: { display: false } }
ย ย ย ย ย ย }
ย ย ย ย });
ย ย }

ย ย function renderBrandChart(data) {
ย ย ย ย const brandSummary = data.reduce((acc, item) => {
ย ย ย ย ย ย const brand = item.brand;
ย ย ย ย ย ย acc[brand] = (acc[brand] || 0) + (item.quantity || 0);
ย ย ย ย ย ย return acc;
ย ย ย ย }, {});
ย ย ย ยย
ย ย ย ย const sortedBrands = Object.entries(brandSummary).sort(([,a], [,b]) => b - a).slice(0, 8);
ย ย ย ย const labels = sortedBrands.map(item => item[0]);
ย ย ย ย const chartData = sortedBrands.map(item => item[1]);
ย ย ย ยย
ย ย ย ย const ctx = document.getElementById('brandChart').getContext('2d');
ย ย ย ยย
ย ย ย ย if (brandChartInstance) {
ย ย ย ย ย ย brandChartInstance.destroy();
ย ย ย ย }
ย ย ย ยย
ย ย ย ย brandChartInstance = new Chart(ctx, {
ย ย ย ย ย ย type: 'doughnut',
ย ย ย ย ย ย data: {
ย ย ย ย ย ย ย ย labels: labels,
s ย ย ย ย ย ย ย datasets: [{
ย ย ย ย ย ย ย ย ย ย label: 'Quantidade',
ย ย ย ย ย ย ย ย ย ย data: chartData,
ย ย ย ย ย ย ย ย ย ย backgroundColor: ['#3b82f6', '#10b981', '#ef4444', '#f97316', '#8b5cf6', '#eab308', '#06b6d4', '#84cc16'],
ย ย ย ย ย ย ย ย ย ย borderWidth: 2,
ย ย ย ย ย ย ย ย ย ย borderColor: '#1e293b'
ย ย ย ย ย ย ย ย }]
ย ย ย ย ย ย },
ย ย ย ย ย ย options: {
ย ย ย ย ย ย ย ย maintainAspectRatio: false,
source_timestamp: 1729272948.729
ย ย ย ย ย ย ย ย responsive: true,
ย ย ย ย ย ย ย ย cutout: '60%',
ย ย ย ย ย ย ย ย plugins: {
ย ย ย ย ย ย ย ย ย ย legend: {
ย ย ย ย ย ย ย ย ย ย ย ย position: 'right',
s ย ย ย ย ย ย ย ย ย ย ย labels: { color: '#d1d5db', font: { size: 12 }, padding: 15 }
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }
ย ย s ย });
ย ย }

ย ย function renderCollectorCards(data) {
ย ย ย ย const collectorSummary = data.reduce((acc, item) => {
ย ย ย ย ย ย const collector = item.collector;
ย ย ย ย ย ย acc[collector] = (acc[collector] || 0) + 1;
s ย ย ย ย ย return acc;
ย ย ย ย }, {});
ย ย ย ยย
ย ย ย ย const sortedCollectors = Object.entries(collectorSummary).sort(([,a], [,b]) => b - a);
ย ย ย ย const container = document.getElementById('collector-container');
ย ย ย ย container.innerHTML = '';
ย ย ย ยย
ย ย ย ย sortedCollectors.forEach(([collectorId, count], index) => {
s ย ย ย ย ย const rank = index + 1;
source_timestamp: 1729272948.729
ย ย ย ย ย ย const rankColors = { 1: 'bg-yellow-500', 2: 'bg-gray-400', 3: 'bg-orange-500' };
ย ย ย ย ย ยย
ย ย ย ย ย ย const card = document.createElement('div');
ย ย ย ย ย ย card.className = 'bg-slate-800 rounded-lg p-4 hover:bg-slate-700 transition duration-300';
ย ย ย ย ย ย card.innerHTML = `
ย ย ย ย ย ย ย ย <div class="flex items-center justify-between">
ย ย ย ย ย ย ย ย ย ย <div class="flex items-center">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="w-8 h-8 ${rankColors[rank] || 'bg-slate-600'} rounded-full flex items-center justify-center text-white font-bold text-sm mr-3">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${rank}
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p class="font-semibold text-white">${collectorId}</p>
source_timestamp: 1729272948.729
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p class="text-sm text-gray-400">${count} registro${count !== 1 ? 's' : ''}</p>
ย ย ย s ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>
s ย ย ย ย ย `;
ย ย ย ย ย ย container.appendChild(card);
ย ย ย ย });
ย ย }

ย ย // Inicializaรงรฃo
ย ย document.addEventListener('DOMContentLoaded', fetchRealData);

ย ย // Atualizar automaticamente a cada 2 minutos
ย ย setInterval(fetchRealData, 120000);

</script>
</body>
</html>
